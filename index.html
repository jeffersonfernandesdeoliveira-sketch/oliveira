<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Inteligente</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f7f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        form {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 24px;
            width: 100%;
            max-width: 500px;
        }
        h2 {
            text-align: center;
            color: #333;
            margin-top: 0;
        }
        div {
            margin-bottom: 16px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box; /* Importante para o padding n√£o quebrar o layout */
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        button:hover {
            background-color: #0056b3;
        }
        /* Classe para esconder/mostrar campos */
        .hidden {
            display: none;
        }
        /* Mensagens de status */
        #status-message {
            text-align: center;
            margin-top: 16px;
            font-size: 0.9em;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #e6f7ec;
            color: #004d1a;
        }
        .error {
            background-color: #fdecea;
            color: #a30000;
        }
    </style>
</head>
<body>

    <form id="finance-form">
        <h2>Registrar Transa√ß√£o</h2>

        <div>
            <label for="data">Data:</label>
            <input type="date" id="data" name="data" required>
        </div>

        <div>
            <label for="tipo">Tipo:</label>
            <select id="tipo" name="tipo" required>
                <option value="">-- Selecione o tipo --</option>
                <option value="Receita">Receita</option>
                <option value="Despesa">Despesa</option>
            </select>
        </div>

        <div>
            <label for="descricao">Descri√ß√£o:</label>
            <input type="text" id="descricao" name="descricao" placeholder="Ex: Almo√ßo, Sal√°rio" required>
        </div>

        <div>
            <label for="valor">Valor (R$):</label>
            <input type="number" id="valor" name="valor" step="0.01" min="0.01" placeholder="25,50" required>
        </div>

        <div>
            <label for="categoria">Categoria:</label>
            <select id="categoria" name="categoria" required>
                <option value="">-- Selecione o tipo primeiro --</option>
                </select>
        </div>
        
        <div>
            <label for="formaPagto">Forma de Pagamento:</label>
            <select id="formaPagto" name="formaPagto" required>
                <option value="">-- Selecione --</option>
                <option value="Pix">Pix</option>
                <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
                <option value="Dinheiro">Dinheiro</option>
                <option value="Boleto">Boleto</option>
                <option value="N/A">N/A (Ex: Sal√°rio)</option>
            </select>
        </div>

        <div>
            <label for="status">Status:</label>
            <select id="status" name="status" required>
                <option value="Pago/Recebido">Pago/Recebido</option>
                <option value="Pendente">Pendente</option>
            </select>
        </div>

        <button type="submit" id="submit-button">Salvar na Planilha</button>

        <div id="status-message"></div>
    </form>



    <script>
        // =================================================================
        // PARTE 1: A "INTELIG√äNCIA" DO FORMUL√ÅRIO (CAMPOS CONDICIONAIS)
        // =================================================================
        
        // Nossas listas de categorias
        const categoriasReceita = [
            "Sal√°rio", "Freelance", "Vendas", "Investimentos", "Outros"
        ];
        const categoriasDespesa = [
            "Alimenta√ß√£o", "Moradia", "Transporte", "Lazer", "Sa√∫de", "Contas", "Outros"
        ];
        
        // Seleciona os elementos do formul√°rio
        const tipoSelect = document.getElementById('tipo');
        const categoriaSelect = document.getElementById('categoria');

        // Adiciona um "ouvinte" que reage a mudan√ßas no campo "Tipo"
        tipoSelect.addEventListener('change', function() {
            // Pega o valor selecionado (Receita ou Despesa)
            const tipoSelecionado = this.value;
            
            // 1. Limpa todas as op√ß√µes anteriores
            categoriaSelect.innerHTML = '<option value="">-- Selecione a categoria --</option>';

            // 2. Decide qual lista de categorias usar
            let categoriasParaMostrar = [];
            if (tipoSelecionado === 'Receita') {
                categoriasParaMostrar = categoriasReceita;
            } else if (tipoSelecionado === 'Despesa') {
                categoriasParaMostrar = categoriasDespesa;
            }

            // 3. Preenche o select de Categoria com as novas op√ß√µes
            categoriasParaMostrar.forEach(function(categoria) {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                categoriaSelect.appendChild(option);
            });
        });

        // =================================================================
        // PARTE 2: O ENVIO DOS DADOS (FETCH API)
        // =================================================================
        
        // üéØ A URL DO SEU BACKEND (APPS SCRIPT)
        // √â a URL que voc√™ me passou!
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzC-UFEm5wgTEN39W8qoHo3dOsF2c1jUkIHKzfrByNLzoI8YSFLqMEI3qGEHDkYfJIzDQ/exec";

        // Seleciona o formul√°rio, o bot√£o e a mensagem de status
        const form = document.getElementById('finance-form');
        const submitButton = document.getElementById('submit-button');
        const statusMessage = document.getElementById('status-message');

        // Adiciona um "ouvinte" para quando o formul√°rio for enviado
        form.addEventListener('submit', async function(e) {
            
            // 1. Previne o comportamento padr√£o do HTML (que √© recarregar a p√°gina)
            e.preventDefault();

            // Desabilita o bot√£o para evitar cliques duplicados
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            statusMessage.innerHTML = ''; // Limpa mensagens antigas
            statusMessage.className = '';

            try {
                // 2. Coleta os dados do formul√°rio
                const formData = new FormData(form);
                const dados = Object.fromEntries(formData.entries());

                // 3. Envia os dados para a URL do Apps Script usando fetch()
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    // O Apps Script 'doPost' espera os dados como uma string de texto,
                    // por isso usamos JSON.stringify() no 'body'.
                    body: JSON.stringify(dados)
                });

                // 4. Espera a resposta do Apps Script
                const result = await response.json();

                // 5. Processa a resposta
                if (result.status === 'sucesso') {
                    // Deu certo!
                    statusMessage.textContent = result.mensagem;
                    statusMessage.className = 'success';
                    form.reset(); // Limpa o formul√°rio
                    
                    // Reseta o campo de categoria
                    categoriaSelect.innerHTML = '<option value="">-- Selecione o tipo primeiro --</option>';

                } else {
                    // Deu erro (conforme a l√≥gica do nosso Apps Script)
                    throw new Error(result.mensagem || 'Erro desconhecido');
                }

            } catch (error) {
                // 6. Captura qualquer erro (de rede ou do nosso 'throw')
                statusMessage.textContent = 'Erro ao enviar: ' + error.message;
                statusMessage.className = 'error';
            } finally {
                // 7. Reabilita o bot√£o, independente de sucesso ou erro
                submitButton.disabled = false;
                submitButton.textContent = 'Salvar na Planilha';
            }
        });

        // B√¥nus: Coloca a data de hoje no campo de data automaticamente
        document.getElementById('data').value = new Date().toISOString().split('T')[0];

    </script>
</body>

</html>
